<div id="mood-page">

  <div class="header container">
    <h1 class="title text">Mood Track</h1>
  </div>

  <div class="text-container">
    {{#if display_name}}
      <p class="greeting text">Hello, {{display_name}}</p>
    {{/if}}
  </div>

  <div class="text-container">
    <p class="size-30 text">Seems like you're feeling <span class="accent">{{mood}}.</span> Here's a track to <span class="accent">{{mood_desc}}.</span></p>
  </div>

  <div class="vert-divider">
    <p class="size-20 text">Your Mood Track</p>
    <hr class="vert-hr" />
  </div>

  <div class="track-container">
    {{#if mood_track}}
      <div class="album-container">
        <img
          src="{{mood_track.album.images.2.url}}"
          alt="Album cover"
          class="album"
          width="100px"
          height="100px">
      </div>
      <div class="track-info-container">
        <p class="track-name text">{{mood_track.name}}</p>
        <p class="track-artist text">{{mood_track.artists.0.name}}</p>
        <p class="track-album-name text">{{mood_track.album.name}}</p>
      </div>
    {{else}}
      <p class="text">No track available</p>
    {{/if}}
  </div>

  <div class="btn-container">
    {{#if mood_track.preview_url}}
      <a
        id="preview-song-link"
        href="{{mood_track.preview_url}}"
        class="a-half text"
        target="_blank"
        rel="noreferrer"
      >
      Preview in new tab</a>
    {{else}}
      <a class="disabled btn-half text">No preview</a>
    {{/if}}
    <button
      type="button"
      id="add-song-button"
      data-songid="{{mood_track.id}}"
      class="btn-half text">Add to library</button>
  </div>

  <div class="vert-divider">
    <p class="size-20 text">Your Recent Tracks</p>
    <hr class="vert-hr" />
  </div>

  <div class="recent-tracks-container">
    {{#each recent_tracks}}
      <div class="track-container">
        <div class="album-container">
          <img
            src="{{this.track.album.images.2.url}}"
            alt="Album cover"
            class="album"
            width="100px"
            height="100px">
        </div>
        <div class="track-info-container">
          <p class="track-name text">{{this.track.name}}</p>
          <p class="track-artist text">{{this.track.artists.0.name}}</p>
          <p class="track-album-name text">{{this.track.album.name}}</p>
        </div>
      </div>
    {{/each}}
  </div>

  <div class="footer container">
    <p class="text">Footer text</p>
  </div>
</div>

<script>
  async function addSong(e) {
    console.log('Clicked to add song');
    // Get target element
    const target = e.target;
    console.log(target);

    // Get song id in data attribute
    const songId = target.dataset.songid;
    console.log(songId);

    // Make fetch post request to server to add song
    await fetch('/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({songId: songId})
    })
    .catch( error => console.log(error) )
    .then( response => {
      console.log(response);
      if (response.status === 200) {
        console.log('Song added!');
        target.textContent = 'Added!';
      } else {
        console.log('Failure to add');
        target.textContent = 'Failed to add';
      }
    });
  }

  const addSongBtn = document.getElementById('add-song-button');
  addSongBtn.addEventListener('click', addSong);
</script>
